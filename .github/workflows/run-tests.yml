name: ğŸ§ª ìë™í™” í…ŒìŠ¤íŠ¸ ì‹¤í–‰

on:
  workflow_dispatch:
    inputs:
      test_target:
        description: 'ğŸ“‹ í…ŒìŠ¤íŠ¸ ì„ íƒ'
        required: true
        type: choice
        default: 'ğŸ¯ ì „ì²´ í…ŒìŠ¤íŠ¸'
        options:
          - 'ğŸ¯ ì „ì²´ í…ŒìŠ¤íŠ¸'
          - 'ğŸ‘¤ êµ¬ì„±ì› (User)'
          - 'ğŸ“‡ ì™¸ë¶€ ì—°ë½ì²˜ (Contact)'
          - 'ğŸ‘¥ ê·¸ë£¹ (Group)'
          - 'ğŸŒ ì™¸ë¶€ ê·¸ë£¹ (External Group)'
          - 'ğŸ¢ ì¡°ì§ (OrgUnit)'
          - 'ğŸ’¼ ì§ì±… (Position)'
          - 'ğŸ“Š ì§ê¸‰ (Level)'
          - 'ğŸ“Œ ìƒíƒœ (Status)'
          - 'ğŸ‘” ì‚¬ìš©ì ìœ í˜• (UserType)'
          - 'ğŸ·ï¸ íšŒì‚¬ íƒœê·¸ (Company Tag)'
          - 'ğŸ“ MY íƒœê·¸ (MY Tag)'
      
      browser:
        description: 'ğŸŒ ë¸Œë¼ìš°ì €'
        required: false
        type: choice
        default: 'chromium'
        options:
          - chromium
          - firefox
          - webkit

jobs:
  test:
    runs-on: ubuntu-latest
    
    # í…ŒìŠ¤íŠ¸ ì´ë¦„ì„ ë™ì ìœ¼ë¡œ í‘œì‹œ
    name: ${{ inputs.test_target }}
    
    container:
      image: mcr.microsoft.com/playwright/python:v1.45.1-jammy
    
    steps:
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
      
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          pip install --no-cache-dir -r requirements.txt
          playwright install
      
      - name: ğŸ”§ í™˜ê²½ ì„¤ì •
        run: |
          cat << EOF > .env
          ENVIRONMENT=${{ secrets.ENVIRONMENT }}
          ADMIN_ID=${{ secrets.ADMIN_ID }}
          ADMIN_PASSWORD=${{ secrets.ADMIN_PASSWORD }}
          HEADLESS=true
          SLOW_MO=0
          EOF
          echo "âœ… í™˜ê²½ ì„¤ì • ì™„ë£Œ"
      
      - name: ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        env:
          PYTHONPATH: ${{ github.workspace }}
          ENVIRONMENT: ${{ secrets.ENVIRONMENT }}
          ADMIN_ID: ${{ secrets.ADMIN_ID }}
          ADMIN_PASSWORD: ${{ secrets.ADMIN_PASSWORD }}
        run: |
          # ì´ëª¨ì§€ ì œê±°í•˜ê³  ì‹¤ì œ í…ŒìŠ¤íŠ¸ ë§¤í•‘
          case "${{ inputs.test_target }}" in
            "ğŸ¯ ì „ì²´ í…ŒìŠ¤íŠ¸")
              echo "ğŸš€ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/ -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸ‘¤ êµ¬ì„±ì› (User)")
              echo "ğŸ‘¤ êµ¬ì„±ì› í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_user.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸ“‡ ì™¸ë¶€ ì—°ë½ì²˜ (Contact)")
              echo "ğŸ“‡ ì™¸ë¶€ ì—°ë½ì²˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_contact.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸ‘¥ ê·¸ë£¹ (Group)")
              echo "ğŸ‘¥ ê·¸ë£¹ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_group.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸŒ ì™¸ë¶€ ê·¸ë£¹ (External Group)")
              echo "ğŸŒ ì™¸ë¶€ ê·¸ë£¹ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_external_group.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸ¢ ì¡°ì§ (OrgUnit)")
              echo "ğŸ¢ ì¡°ì§ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_orgunit.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸ’¼ ì§ì±… (Position)")
              echo "ğŸ’¼ ì§ì±… í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_position.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸ“Š ì§ê¸‰ (Level)")
              echo "ğŸ“Š ì§ê¸‰ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_level.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸ“Œ ìƒíƒœ (Status)")
              echo "ğŸ“Œ ìƒíƒœ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_status.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸ‘” ì‚¬ìš©ì ìœ í˜• (UserType)")
              echo "ğŸ‘” ì‚¬ìš©ì ìœ í˜• í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_usertype.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸ·ï¸ íšŒì‚¬ íƒœê·¸ (Company Tag)")
              echo "ğŸ·ï¸ íšŒì‚¬ íƒœê·¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_company_tag.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
            "ğŸ“ MY íƒœê·¸ (MY Tag)")
              echo "ğŸ“ MY íƒœê·¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
              pytest tests/test_my_tag.py -v --browser=${{ inputs.browser }} --html=report.html --self-contained-html
              ;;
          esac
      
      - name: ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì—…ë¡œë“œ
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-report-${{ github.run_number }}
          path: |
            report.html
            test-results/
          retention-days: 30
      
      - name: ğŸ“¸ ì‹¤íŒ¨ ìŠ¤í¬ë¦°ìƒ· ì—…ë¡œë“œ
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: failure-screenshots-${{ github.run_number }}
          path: test-results/**/*.png
          retention-days: 7
      
      - name: ğŸ“‹ í…ŒìŠ¤íŠ¸ ìš”ì•½
        if: always()
        run: |
          echo "### ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì™„ë£Œ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **ì„ íƒí•œ í…ŒìŠ¤íŠ¸:** ${{ inputs.test_target }}" >> $GITHUB_STEP_SUMMARY
          echo "- **ë¸Œë¼ìš°ì €:** ${{ inputs.browser }}" >> $GITHUB_STEP_SUMMARY
          echo "- **ì‹¤í–‰ í™˜ê²½:** ${{ secrets.ENVIRONMENT }}" >> $GITHUB_STEP_SUMMARY
          echo "- **ì‹¤í–‰ ë²ˆí˜¸:** #${{ github.run_number }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ“Š ìƒì„¸ ê²°ê³¼ëŠ” **Artifacts**ì—ì„œ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”." >> $GITHUB_STEP_SUMMARY

